<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RULEV3+ Validation Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 20px;
            font-size: 12px;
        }
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .stat-box {
            background: #1a1a24;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px 20px;
            text-align: center;
        }
        .stat-box h3 { color: #888; font-size: 11px; margin-bottom: 4px; }
        .stat-box .value { font-size: 18px; font-weight: bold; }
        .stat-box .value.green { color: #00ff88; }
        .stat-box .value.red { color: #ff4444; }
        .stat-box .value.blue { color: #4488ff; }
        .stat-box .value.yellow { color: #ffcc00; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .panel {
            background: #12121a;
            border: 1px solid #2a2a3a;
            border-radius: 12px;
            padding: 16px;
        }
        .panel h2 {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 12px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .heatmap-container {
            overflow-x: auto;
        }
        .heatmap {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 10px;
        }
        .heatmap-row {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .heatmap-label {
            width: 100px;
            color: #888;
            text-align: right;
            padding-right: 8px;
        }
        .heatmap-cells {
            display: flex;
            gap: 1px;
        }
        .heatmap-cell {
            width: 12px;
            height: 24px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px;
            color: #000;
        }
        .ladder-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .ladder-table th {
            background: #1a1a24;
            padding: 8px;
            text-align: left;
            color: #888;
            border-bottom: 1px solid #333;
        }
        .ladder-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #222;
        }
        .ladder-table tr:hover { background: #1a1a24; }
        .bar {
            height: 16px;
            border-radius: 3px;
            display: inline-block;
        }
        .legend {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 11px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #555;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>RULEV3+ Validation Dashboard</h1>
    <div class="subtitle">Raw data only. No normalization. No truncation.</div>

    <div class="stats-bar">
        <div class="stat-box">
            <h3>LIVE CURRENT</h3>
            <div class="value blue">33 trades</div>
            <div style="font-size:12px">75.76% WR | PnL: $19.0</div>
        </div>
        <div class="stat-box">
            <h3>BACKTEST CURRENT (3:00-3:29)</h3>
            <div class="value green">1008 trades</div>
            <div style="font-size:12px">71.43% WR | PnL: $40.24</div>
        </div>
        <div class="stat-box">
            <h3>BACKTEST EXTENDED (2:30-3:45)</h3>
            <div class="value yellow">1411 trades</div>
            <div style="font-size:12px">71.23% WR | PnL: $59.56</div>
        </div>
    </div>

    <div class="grid">
        <!-- Panel 1: Equity Curves -->
        <div class="panel">
            <h2>1. EQUITY CURVES (Raw Cumulative PnL)</h2>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background:#4488ff"></div>Live Current</div>
                <div class="legend-item"><div class="legend-dot" style="background:#00ff88"></div>Backtest Current</div>
                <div class="legend-item"><div class="legend-dot" style="background:#ffcc00"></div>Backtest Extended</div>
            </div>
            <div class="chart-container">
                <canvas id="equityChart"></canvas>
            </div>
        </div>

        <!-- Panel 2: Entry Timing Histogram -->
        <div class="panel">
            <h2>2. ENTRY TIMING HISTOGRAM (5s bins, 150-225s)</h2>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background:#4488ff"></div>Live Current</div>
                <div class="legend-item"><div class="legend-dot" style="background:#00ff88"></div>Backtest Current</div>
                <div class="legend-item"><div class="legend-dot" style="background:#ffcc00"></div>Backtest Extended</div>
            </div>
            <div class="chart-container">
                <canvas id="histogramChart"></canvas>
            </div>
        </div>

        <!-- Panel 3: Heatmap -->
        <div class="panel">
            <h2>3. WIN RATE HEATMAP BY SECOND (150-225s)</h2>
            <div class="heatmap-container">
                <div class="heatmap" id="heatmapContainer"></div>
            </div>
            <div style="margin-top:12px; font-size:10px; color:#666; text-align:center;">
                Color scale: <span style="color:#ff4444">Red &lt;50%</span> |
                <span style="color:#ffcc00">Yellow 50-70%</span> |
                <span style="color:#00ff88">Green &gt;70%</span> |
                <span style="color:#444">Gray = No data</span>
            </div>
        </div>

        <!-- Panel 4: Edge vs WR Ladder -->
        <div class="panel">
            <h2>4. EDGE vs WIN RATE LADDER</h2>
            <table class="ladder-table">
                <thead>
                    <tr>
                        <th>Edge</th>
                        <th>BT Current (n)</th>
                        <th>BT Current WR</th>
                        <th>BT Extended (n)</th>
                        <th>BT Extended WR</th>
                        <th>Delta</th>
                    </tr>
                </thead>
                <tbody id="ladderBody"></tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        Generated from raw trade data | Live: 33 trades | BT Current: 1008 trades | BT Extended: 1411 trades
    </div>

    <script>
        // Data from Python
        const eqLive = [0, 2.69, -2.31, 0.15, 2.73, 5.08, 0.08, 2.12, 4.47, 7.16, 2.16, 4.85, 6.89, 9.14, 11.83, 6.83, 8.87, 11.22, 6.22, 8.8, 11.05, 13.19, 15.23, 17.37, 19.41, 14.41, 16.99, 19.24, 21.93, 24.07, 26.65, 21.65, 24.0, 19.0];
        const eqBtCurrent = [0, -0.65, -0.32, -0.97, -0.62, -0.27, -0.92, -0.63, -1.28, -1.93, -1.58, -2.25, -1.96, -2.63, -3.3, -2.97, -2.63, -2.28, -1.99, -2.69, -2.34, -3.05, -3.75, -3.42, -3.07, -3.73, -3.4, -3.07, -2.78, -2.45, -2.1, -1.79, -1.46, -2.11, -1.82, -1.53, -1.18, -0.83, -0.54, -0.19, 0.11, -0.57, -0.22, -0.87, -0.54, -0.21, 0.12, 0.41, -0.24, -0.93, -0.58, -0.24, 0.1, 0.39, -0.32, 0.0, 0.29, -0.41, -1.07, -1.75, -1.4, -1.06, -0.74, -0.45, -1.12, -0.77, -0.42, -0.07, 0.28, 0.57, 0.87, 1.19, 1.48, 0.83, 1.13, 1.47, 0.82, 0.16, 0.51, -0.14, 0.21, 0.56, -0.11, 0.24, 0.59, 0.94, 1.24, 1.55, 0.84, 1.18, 0.48, 0.78, 1.1, 0.41, -0.28, -0.93, -0.64, -0.32, -0.99, -0.65, -0.3, -0.01, 0.32, 0.67, 1.02, 0.37, 0.71, 1.03, 1.38, 1.73, 2.08, 2.38, 2.69, 3.0, 2.29, 1.64, 1.93, 1.28, 1.58, 1.93, 2.24, 2.58, 2.93, 3.22, 3.51, 2.81, 3.15, 3.5, 3.85, 4.2, 3.49, 2.82, 2.11, 2.46, 2.8, 2.15, 2.45, 2.74, 2.05, 2.4, 2.73, 3.08, 2.42, 2.75, 3.1, 3.39, 3.74, 4.09, 4.43, 3.77, 3.12, 2.47, 2.81, 3.1, 3.39, 2.74, 3.03, 2.38, 2.73, 3.02, 2.37, 2.72, 3.06, 2.37, 2.72, 3.01, 3.32, 3.65, 3.0, 3.35, 3.64, 3.99, 4.33, 4.68, 5.0, 5.35, 5.69, 6.0, 6.29, 6.62, 6.97, 7.3, 7.59, 7.94, 8.26, 8.55, 7.88, 8.21, 8.56, 8.85, 8.15, 8.44, 8.79, 9.08, 9.4, 9.73, 10.08, 9.37, 8.66, 7.95, 8.25, 8.54, 8.87, 9.22, 9.57, 9.91, 10.2, 9.55, 8.84, 9.19, 9.48, 9.83, 10.12, 10.45, 10.78, 11.09, 11.44, 11.74, 12.08, 12.43, 11.72, 12.02, 12.31, 12.6, 12.94, 13.28, 13.57, 13.86, 14.16, 14.45, 14.8, 15.1, 15.45, 15.8, 15.15, 15.46, 15.81, 16.16, 16.47, 15.77, 16.08, 16.37, 16.66, 15.95, 16.3, 16.65, 17.0, 16.34, 16.69, 17.0, 17.35, 17.7, 17.01, 17.35, 17.64, 16.98, 17.29, 16.63, 16.92, 16.27, 16.62, 16.91, 17.21, 17.5, 17.85, 17.2, 17.55, 17.9, 18.25, 18.6, 18.95, 19.29, 19.59, 18.94, 18.23, 18.56, 18.88, 19.18, 19.52, 19.87, 20.22, 20.56, 20.91, 20.21, 20.56, 19.86, 20.21, 19.5, 18.85, 18.2, 18.5, 18.84, 18.13, 17.43, 17.74, 17.09, 16.44, 16.73, 17.05, 16.34, 15.69, 16.04, 16.38, 16.72, 17.06, 17.41, 17.7, 17.99, 17.3, 17.59, 16.88, 17.23, 16.58, 15.88, 16.19, 15.54, 14.88, 14.23, 14.52, 14.87, 15.18, 14.53, 14.82, 15.17, 15.46, 15.76, 15.11, 15.46, 14.81, 15.1, 15.4, 14.74, 15.03, 15.32, 15.61, 14.95, 15.3, 15.65, 16.0, 16.35, 16.66, 16.01, 16.3, 16.59, 16.94, 16.24, 16.53, 16.82, 17.17, 16.52, 16.87, 17.16, 17.45, 17.79, 17.12, 17.47, 16.76, 17.05, 16.35, 16.65, 16.99, 17.34, 17.69, 17.98, 18.27, 17.62, 17.94, 18.29, 17.58, 17.91, 18.26, 18.61, 18.92, 19.26, 18.55, 17.9, 17.24, 17.53, 17.82, 18.11, 18.44, 18.73, 19.02, 19.36, 19.69, 20.04, 20.39, 20.68, 21.0, 21.35, 21.64, 21.99, 21.33, 21.67, 21.97, 22.28, 22.57, 22.88, 23.23, 23.52, 23.85, 24.18, 24.52, 23.87, 24.22, 24.57, 24.89, 24.2, 23.53, 23.87, 24.17, 24.52, 23.86, 23.21, 23.5, 23.79, 24.14, 23.45, 23.74, 24.09, 24.44, 24.73, 24.08, 24.37, 24.67, 23.99, 24.29, 23.64, 23.97, 23.31, 22.66, 23.0, 23.34, 23.69, 24.04, 24.36, 24.65, 24.0, 24.32, 24.65, 24.99, 25.33, 25.68, 25.0, 25.29, 25.64, 25.94, 26.29, 26.58, 26.9, 27.2, 27.52, 27.86, 28.15, 27.47, 27.81, 28.13, 27.44, 27.77, 27.12, 27.41, 27.75, 28.1, 28.45, 27.76, 27.11, 27.44, 27.79, 28.08, 27.42, 27.73, 28.02, 28.37, 28.72, 29.05, 29.38, 29.73, 30.06, 30.38, 30.69, 31.04, 31.33, 31.68, 32.03, 32.33, 32.67, 33.01, 33.36, 33.71, 33.06, 33.35, 33.65, 34.0, 34.35, 34.68, 35.03, 34.34, 34.69, 35.04, 35.33, 35.64, 34.95, 35.3, 35.63, 35.92, 36.21, 36.56, 36.91, 37.2, 36.5, 35.79, 36.08, 35.42, 34.71, 35.06, 34.36, 34.69, 35.03, 35.38, 34.72, 35.07, 34.4, 34.72, 34.07, 33.4, 32.75, 33.06, 33.41, 32.76, 32.05, 32.4, 32.74, 33.09, 33.42, 32.73, 32.02, 32.32, 31.67, 31.98, 32.33, 32.62, 31.97, 31.32, 30.67, 30.98, 30.28, 29.61, 28.91, 29.24, 29.53, 29.82, 30.11, 30.4, 29.71, 30.06, 30.38, 30.73, 30.08, 30.38, 30.73, 31.08, 30.43, 29.72, 30.07, 29.41, 28.76, 28.08, 28.43, 28.78, 29.07, 29.42, 29.77, 29.06, 29.41, 29.74, 30.09, 29.44, 28.79, 29.14, 29.49, 29.83, 30.17, 30.5, 30.85, 30.17, 30.51, 29.8, 30.09, 30.43, 29.72, 29.05, 29.4, 28.75, 28.1, 27.45, 26.74, 27.09, 27.44, 27.79, 28.14, 28.49, 28.78, 28.12, 28.47, 28.82, 29.16, 28.45, 28.74, 28.04, 28.33, 28.68, 29.03, 29.36, 29.71, 30.0, 30.32, 30.61, 30.92, 31.23, 31.52, 30.87, 31.22, 31.57, 31.86, 32.19, 31.54, 31.87, 31.22, 31.56, 31.9, 31.23, 31.58, 30.92, 31.27, 31.62, 31.97, 32.27, 32.58, 31.93, 32.28, 32.63, 32.98, 33.28, 33.61, 33.96, 34.27, 34.62, 34.97, 34.32, 34.61, 34.95, 35.25, 35.54, 34.89, 35.18, 35.53, 35.85, 36.15, 36.47, 36.82, 37.17, 37.52, 37.83, 38.16, 37.51, 36.81, 36.14, 36.49, 36.84, 37.17, 37.49, 37.82, 37.17, 37.46, 37.77, 38.11, 37.46, 37.8, 37.12, 37.47, 37.82, 38.11, 38.4, 37.75, 37.1, 37.45, 36.8, 37.09, 36.44, 36.74, 36.09, 36.44, 36.75, 36.1, 36.41, 36.7, 35.99, 36.34, 36.66, 37.01, 37.32, 36.67, 36.02, 36.37, 36.71, 36.06, 36.39, 36.73, 37.07, 37.42, 37.75, 37.1, 36.43, 36.73, 37.04, 36.34, 36.63, 36.93, 36.26, 35.61, 35.93, 36.28, 35.61, 35.9, 36.25, 36.6, 36.95, 37.28, 37.57, 36.89, 36.21, 36.53, 36.85, 36.15, 35.49, 35.84, 36.18, 35.52, 34.87, 35.22, 35.52, 34.81, 34.15, 34.46, 34.8, 34.09, 34.44, 33.74, 34.08, 34.4, 34.75, 34.09, 34.38, 34.68, 35.03, 35.34, 34.69, 34.99, 34.29, 34.64, 34.98, 35.33, 35.68, 36.03, 36.32, 36.66, 35.95, 36.3, 36.59, 36.9, 37.25, 37.56, 37.86, 37.21, 37.55, 37.84, 38.18, 38.47, 37.78, 38.13, 38.44, 38.73, 39.03, 39.38, 39.7, 40.02, 40.31, 40.66, 41.01, 41.36, 40.71, 40.06, 39.35, 39.7, 40.05, 39.35, 39.66, 39.95, 40.24, 39.59, 38.92, 38.21, 38.51, 38.8, 39.15, 39.5, 39.81, 40.1, 39.45, 39.78, 40.13, 40.42, 40.77, 40.06, 39.41, 39.74, 40.03, 40.36, 40.67, 40.96, 41.31, 41.6, 41.94, 41.27, 41.56, 40.87, 41.16, 41.45, 41.75, 42.1, 41.39, 41.71, 42.06, 41.41, 41.71, 42.06, 42.35, 42.7, 43.02, 43.34, 43.63, 43.92, 44.21, 43.5, 42.85, 43.18, 42.47, 42.82, 42.17, 42.5, 42.82, 43.14, 43.48, 43.8, 43.11, 43.46, 43.81, 44.16, 44.49, 44.84, 45.19, 45.53, 44.87, 44.21, 44.56, 44.85, 45.16, 45.51, 45.82, 45.11, 45.46, 45.81, 45.15, 44.47, 44.82, 44.17, 43.52, 43.87, 44.19, 43.54, 43.86, 44.21, 43.56, 43.85, 43.14, 42.49, 42.84, 43.19, 43.54, 43.88, 44.18, 44.53, 43.82, 44.17, 44.51, 44.85, 45.2, 45.55, 45.9, 45.25, 45.57, 45.87, 46.22, 46.57, 46.92, 46.22, 46.56, 46.91, 46.26, 45.61, 44.96, 45.3, 45.59, 45.94, 46.27, 45.6, 44.93, 45.22, 45.51, 45.82, 46.11, 45.46, 45.76, 46.11, 45.42, 44.76, 45.09, 44.39, 43.71, 43.05, 43.34, 43.63, 42.92, 42.27, 41.6, 41.89, 41.18, 41.48, 41.83, 41.15, 41.45, 40.74, 41.09, 40.42, 39.77, 39.12, 39.47, 39.76, 40.05, 39.36, 39.65, 38.95, 38.24, 37.57, 37.9, 37.21, 37.54, 37.89, 38.21, 37.56, 37.88, 37.19, 36.48, 36.83, 36.16, 36.45, 36.75, 37.07, 36.42, 36.76, 37.05, 37.34, 37.63, 37.98, 38.33, 38.62, 38.94, 39.26, 38.61, 38.96, 39.31, 39.66, 39.95, 40.28, 40.63, 39.94, 40.23, 40.52, 40.87, 40.22, 39.55, 38.9, 39.2, 39.49, 39.81, 40.11, 39.42, 39.74, 40.06, 40.41, 40.7, 39.99, 39.32, 39.65, 39.0, 39.35, 39.65, 39.94, 40.24];
        const eqBtExtended = [0, -0.65, -1.3, -0.95, -1.6, -1.25, -1.91, -1.56, -2.21, -1.87, -1.58, -1.23, -0.9, -1.55, -2.2, -1.91, -1.6, -1.31, -1.02, -0.73, -1.4, -2.06, -1.77, -1.43, -2.14, -1.84, -1.49, -1.14, -0.81, -1.46, -2.11, -2.79, -2.44, -3.15, -2.8, -3.51, -3.16, -2.81, -3.46, -3.13, -2.78, -2.43, -2.12, -1.77, -1.46, -1.15, -0.82, -0.5, -0.15, 0.18, -0.47, -1.18, -0.89, -0.59, -0.25, -0.92, -0.62, -0.27, 0.08, 0.37, 0.66, 1.01, 1.31, 1.66, 1.95, 1.25, 1.55, 1.87, 1.22, 1.51, 1.85, 1.2, 1.52, 1.81, 1.16, 0.49, 0.84, 1.19, 1.53, 1.87, 2.17, 2.51, 2.86, 2.18, 2.52, 2.81, 2.15, 1.5, 1.85, 1.2, 0.53, -0.13, 0.22, 0.57, 0.92, 1.26, 1.61, 1.94, 2.23, 1.52, 1.87, 2.22, 1.56, 1.91, 2.26, 2.6, 2.89, 3.24, 3.58, 3.93, 4.22, 3.57, 3.86, 3.15, 3.49, 2.84, 2.18, 2.47, 2.82, 2.17, 2.52, 2.87, 2.21, 2.56, 1.91, 2.2, 2.49, 2.84, 2.17, 2.5, 1.79, 2.13, 2.48, 2.78, 2.13, 1.42, 1.77, 1.12, 1.46, 0.81, 1.1, 1.39, 0.68, 0.03, -0.66, -1.31, -1.0, -0.65, -0.3, 0.01, -0.65, -1.3, -0.96, -0.62, -0.29, 0.04, 0.35, 0.7, 1.05, 0.4, 0.75, 1.04, 1.39, 1.74, 2.09, 2.43, 2.78, 3.13, 3.45, 2.8, 2.15, 2.44, 1.79, 2.14, 2.43, 2.78, 3.09, 3.44, 3.79, 4.09, 4.38, 3.71, 4.01, 4.35, 4.7, 5.02, 5.37, 4.66, 5.0, 5.34, 4.69, 4.04, 3.34, 3.68, 3.98, 4.33, 4.67, 4.02, 4.32, 4.62, 3.93, 4.28, 4.62, 4.95, 5.3, 4.65, 4.99, 5.34, 5.63, 5.92, 6.27, 6.62, 6.97, 6.31, 6.65, 6.0, 5.33, 5.68, 6.03, 6.37, 6.69, 5.98, 6.32, 6.61, 5.96, 5.3, 5.65, 6.0, 6.31, 5.6, 4.93, 5.28, 5.58, 4.93, 5.28, 5.58, 5.9, 6.23, 6.58, 6.88, 6.23, 5.58, 5.93, 6.28, 6.63, 6.92, 7.27, 7.59, 7.88, 8.2, 8.49, 8.84, 9.19, 9.48, 9.81, 10.15, 10.5, 10.79, 11.14, 11.43, 11.78, 12.13, 11.48, 11.82, 12.17, 12.52, 11.87, 12.16, 12.51, 11.8, 12.09, 12.44, 12.79, 13.14, 13.45, 12.8, 13.15, 13.5, 13.79, 14.08, 13.38, 12.67, 12.02, 12.36, 12.7, 12.99, 13.31, 13.66, 14.01, 14.35, 14.67, 14.02, 13.36, 13.68, 13.97, 14.26, 14.61, 14.9, 15.19, 15.54, 15.89, 16.24, 16.56, 16.91, 17.26, 17.61, 17.96, 18.3, 17.62, 17.91, 18.21, 18.51, 18.86, 19.15, 19.45, 19.74, 20.09, 20.41, 20.71, 21.06, 21.35, 21.7, 21.99, 22.34, 22.69, 22.01, 22.32, 22.67, 23.02, 23.37, 23.72, 24.01, 23.36, 23.65, 23.94, 24.27, 23.57, 22.86, 23.2, 22.55, 22.89, 23.23, 23.58, 23.93, 23.22, 22.52, 22.87, 23.2, 23.49, 23.84, 24.19, 23.54, 23.87, 24.22, 24.56, 24.85, 25.15, 24.44, 24.73, 24.08, 24.43, 23.76, 23.11, 23.46, 23.8, 24.09, 24.44, 24.75, 25.08, 25.37, 24.72, 24.07, 24.41, 24.74, 25.09, 25.4, 25.75, 26.1, 26.44, 26.73, 27.03, 26.37, 25.72, 26.02, 26.37, 26.66, 26.97, 27.27, 27.62, 27.97, 28.26, 28.61, 28.95, 29.3, 28.64, 28.99, 28.28, 28.63, 27.96, 27.31, 27.65, 26.99, 27.28, 27.63, 26.92, 26.27, 26.61, 25.96, 26.25, 26.57, 26.86, 26.21, 26.56, 25.91, 25.26, 25.61, 25.9, 26.25, 25.54, 25.89, 26.24, 26.59, 26.94, 27.28, 27.62, 27.97, 28.32, 28.61, 27.9, 28.19, 27.48, 27.83, 27.17, 26.46, 26.78, 27.13, 26.48, 25.83, 25.18, 24.53, 24.82, 24.14, 24.46, 24.81, 24.11, 24.46, 24.8, 25.15, 25.5, 24.84, 25.13, 25.42, 24.77, 25.12, 25.44, 25.79, 26.14, 25.49, 25.78, 26.13, 25.44, 25.79, 26.08, 26.43, 25.76, 26.05, 25.4, 25.74, 26.09, 26.42, 26.77, 27.12, 27.41, 26.76, 27.06, 27.41, 27.72, 27.01, 27.36, 27.71, 27.06, 26.41, 26.76, 27.09, 27.44, 26.74, 27.03, 26.38, 26.7, 26.99, 26.28, 26.63, 26.96, 27.31, 27.66, 28.01, 27.3, 27.65, 26.94, 27.23, 26.52, 26.84, 27.19, 27.48, 27.81, 28.1, 28.45, 28.8, 29.09, 28.39, 28.72, 29.07, 29.42, 29.76, 30.11, 29.4, 29.73, 30.08, 30.43, 30.72, 31.07, 30.42, 30.74, 31.09, 30.41, 29.76, 30.11, 29.46, 29.75, 30.09, 30.38, 30.69, 31.01, 31.3, 31.59, 31.94, 32.29, 32.64, 32.99, 33.32, 32.65, 32.0, 32.35, 32.64, 31.99, 32.28, 32.63, 32.98, 33.33, 32.67, 33.02, 33.31, 33.61, 33.92, 34.21, 34.53, 34.83, 35.18, 35.51, 35.86, 36.21, 36.5, 36.85, 37.17, 37.52, 36.87, 37.22, 37.57, 37.88, 38.21, 37.54, 36.85, 36.14, 35.49, 35.83, 36.12, 35.44, 34.79, 35.08, 35.37, 35.72, 35.06, 35.37, 34.72, 35.01, 35.34, 35.63, 34.94, 35.23, 35.57, 35.91, 36.25, 36.59, 35.94, 36.24, 36.53, 36.83, 36.12, 36.42, 35.71, 36.06, 35.41, 35.74, 35.09, 34.44, 34.74, 34.09, 34.44, 34.76, 35.11, 35.4, 35.75, 36.04, 35.34, 35.66, 36.01, 36.34, 36.68, 37.03, 37.38, 37.72, 38.07, 38.39, 38.71, 39.06, 39.36, 39.7, 39.05, 39.34, 39.69, 40.01, 40.3, 40.6, 40.94, 41.29, 41.63, 41.98, 42.33, 42.67, 42.96, 42.27, 42.62, 42.96, 42.27, 41.62, 40.96, 41.28, 41.57, 40.92, 41.21, 41.56, 41.91, 42.26, 42.61, 41.93, 41.28, 41.61, 41.96, 42.31, 42.6, 41.91, 42.21, 42.5, 42.85, 43.2, 42.53, 42.88, 43.23, 42.58, 42.93, 43.28, 42.63, 42.98, 43.33, 43.65, 43.95, 44.3, 44.62, 44.97, 45.32, 45.67, 46.02, 46.32, 46.66, 46.96, 47.27, 47.62, 47.96, 48.31, 48.64, 48.93, 49.28, 49.63, 49.97, 49.27, 49.62, 48.91, 48.2, 48.5, 48.79, 49.14, 48.49, 47.84, 47.13, 47.48, 47.77, 48.12, 47.46, 47.8, 48.1, 48.43, 47.78, 48.13, 48.48, 48.83, 49.17, 48.47, 47.81, 48.16, 48.51, 47.85, 48.2, 47.49, 46.82, 46.17, 46.52, 45.84, 45.13, 45.48, 45.79, 46.14, 46.44, 46.79, 47.14, 46.48, 46.83, 47.18, 46.53, 46.86, 46.21, 45.56, 44.85, 44.2, 44.55, 43.9, 44.25, 43.6, 42.95, 43.3, 43.65, 43.98, 44.33, 44.68, 44.01, 44.34, 44.63, 43.98, 43.33, 42.62, 42.91, 42.22, 42.56, 42.91, 43.26, 43.56, 42.85, 42.18, 42.5, 41.85, 42.18, 41.53, 40.86, 41.16, 40.47, 40.82, 41.11, 41.46, 41.81, 41.1, 41.39, 41.68, 42.03, 41.38, 40.73, 41.02, 41.37, 41.71, 42.06, 42.4, 41.75, 42.1, 42.45, 42.77, 42.12, 41.41, 41.75, 42.08, 42.42, 42.75, 43.09, 43.42, 43.76, 44.06, 44.41, 43.76, 43.09, 43.38, 43.73, 44.08, 43.43, 43.78, 44.13, 44.47, 44.76, 45.11, 45.46, 44.75, 44.1, 43.42, 43.77, 43.11, 43.44, 43.79, 43.14, 42.43, 42.78, 43.12, 43.47, 42.82, 43.17, 43.52, 43.87, 43.21, 43.55, 42.84, 42.19, 42.5, 42.85, 42.14, 41.49, 40.82, 41.16, 40.51, 40.86, 40.21, 39.54, 38.89, 38.18, 37.5, 37.85, 38.2, 37.55, 37.9, 38.25, 38.56, 37.91, 38.26, 38.61, 38.96, 39.27, 38.57, 38.86, 38.21, 38.56, 38.85, 39.2, 38.55, 38.9, 39.25, 39.6, 39.89, 40.24, 40.56, 40.88, 41.21, 41.5, 40.85, 41.2, 41.53, 41.85, 42.18, 41.53, 40.86, 41.18, 40.53, 40.88, 41.23, 40.58, 40.93, 40.27, 39.62, 39.97, 40.32, 40.67, 41.02, 41.37, 41.72, 42.07, 41.36, 40.7, 41.05, 41.4, 41.75, 42.1, 42.45, 42.8, 43.15, 43.5, 43.82, 44.17, 44.49, 43.84, 43.19, 42.52, 42.84, 43.14, 43.49, 43.78, 43.11, 43.43, 43.76, 43.11, 43.46, 42.78, 43.07, 43.42, 43.71, 44.06, 44.36, 44.71, 45.06, 45.35, 45.68, 45.03, 44.32, 43.67, 43.96, 44.31, 44.6, 44.95, 45.3, 45.65, 46.0, 46.34, 46.69, 46.01, 45.36, 45.68, 46.02, 46.35, 46.7, 46.99, 46.34, 46.68, 46.03, 46.38, 46.73, 47.04, 47.38, 47.67, 47.98, 47.33, 46.68, 47.03, 46.37, 46.66, 46.01, 46.31, 45.66, 46.01, 45.36, 45.71, 45.06, 45.41, 45.73, 46.02, 45.34, 44.67, 45.0, 45.35, 45.66, 45.98, 45.33, 45.68, 45.03, 44.38, 44.71, 45.06, 45.4, 44.69, 44.04, 44.39, 43.72, 44.06, 44.41, 44.76, 45.05, 44.4, 43.73, 44.07, 44.38, 44.73, 45.05, 45.4, 45.75, 46.04, 46.35, 45.64, 44.97, 45.26, 45.61, 44.96, 45.31, 45.62, 45.91, 46.26, 46.61, 45.96, 46.31, 46.6, 46.95, 46.3, 46.65, 46.94, 46.26, 45.55, 44.87, 45.22, 45.57, 45.89, 46.21, 45.54, 45.89, 45.24, 44.53, 44.88, 45.22, 45.51, 44.8, 44.14, 43.48, 42.82, 43.17, 43.52, 43.87, 44.18, 43.5, 42.84, 43.17, 43.48, 43.83, 44.18, 43.49, 43.82, 43.14, 43.46, 43.8, 44.09, 44.39, 43.68, 43.97, 44.3, 44.65, 44.94, 45.28, 45.62, 44.92, 45.24, 45.54, 44.89, 44.24, 44.58, 44.93, 45.28, 45.57, 45.9, 46.25, 46.6, 46.9, 47.23, 47.57, 46.86, 47.21, 47.5, 47.81, 48.16, 48.51, 48.8, 49.15, 48.5, 48.8, 49.15, 49.47, 48.77, 49.06, 49.35, 49.68, 49.01, 49.36, 49.67, 49.96, 50.25, 50.6, 50.89, 51.21, 51.55, 51.84, 52.19, 51.54, 51.89, 52.21, 52.56, 51.91, 51.26, 50.59, 49.88, 50.23, 50.58, 49.89, 50.24, 50.57, 50.92, 51.27, 50.62, 49.93, 49.22, 49.52, 49.82, 50.16, 50.45, 50.8, 51.13, 51.46, 51.75, 51.1, 51.45, 51.8, 52.14, 52.49, 51.8, 52.15, 51.5, 51.79, 52.08, 52.39, 52.74, 53.03, 53.38, 53.67, 53.99, 54.34, 54.64, 54.99, 55.34, 55.63, 54.97, 55.32, 55.62, 55.91, 55.23, 54.58, 54.93, 54.26, 53.61, 53.91, 54.26, 54.61, 53.9, 53.19, 53.51, 53.86, 54.18, 53.53, 53.88, 54.23, 54.52, 54.87, 55.22, 55.55, 55.89, 55.23, 55.58, 54.91, 55.26, 55.55, 54.84, 54.19, 54.52, 53.81, 54.1, 54.45, 53.8, 54.15, 54.44, 54.79, 55.14, 55.43, 55.78, 56.1, 55.4, 55.75, 56.1, 55.45, 55.8, 56.15, 56.5, 56.85, 57.14, 57.49, 57.84, 58.19, 57.53, 56.88, 57.23, 57.58, 57.87, 58.22, 58.57, 58.88, 59.23, 58.58, 58.93, 58.28, 57.62, 56.96, 56.27, 55.6, 55.95, 55.24, 55.59, 54.94, 54.23, 54.56, 54.91, 55.22, 54.57, 54.89, 54.24, 54.55, 54.84, 54.14, 53.49, 52.78, 53.13, 52.42, 51.77, 52.12, 51.47, 51.79, 52.14, 52.49, 52.84, 53.17, 52.52, 52.81, 53.16, 53.45, 52.74, 53.09, 53.43, 53.78, 54.07, 54.42, 54.77, 55.06, 55.41, 54.76, 55.11, 55.4, 55.75, 56.1, 56.45, 56.8, 57.13, 57.43, 57.78, 57.11, 57.44, 57.79, 58.12, 57.47, 56.82, 56.11, 56.42, 56.77, 57.06, 57.41, 57.75, 58.06, 58.41, 57.74, 57.09, 57.41, 57.72, 58.07, 58.36, 58.65, 58.98, 59.32, 58.67, 59.02, 59.34, 59.69, 59.03, 58.35, 57.66, 58.01, 57.3, 56.64, 55.99, 56.28, 56.57, 56.9, 56.19, 55.48, 55.77, 55.12, 54.44, 54.75, 54.04, 54.37, 54.7, 55.04, 55.39, 54.73, 55.06, 54.35, 54.7, 55.01, 54.32, 53.67, 54.02, 53.37, 53.66, 53.98, 54.33, 54.68, 55.03, 54.34, 54.63, 53.96, 53.31, 52.66, 53.01, 53.35, 52.66, 53.0, 53.34, 53.66, 54.01, 53.36, 53.7, 52.99, 52.34, 52.69, 51.99, 52.34, 52.69, 53.03, 52.38, 52.73, 53.02, 53.31, 53.64, 53.96, 54.31, 54.66, 55.01, 55.35, 55.67, 56.02, 56.33, 55.68, 56.03, 56.38, 56.73, 57.08, 57.43, 57.76, 58.11, 58.44, 58.79, 58.09, 58.38, 58.73, 59.08, 58.38, 57.73, 58.06, 57.4, 56.75, 57.04, 57.37, 57.72, 58.01, 58.31, 58.6, 57.95, 58.26, 58.61, 58.96, 59.31, 58.61, 57.96, 58.31, 57.66, 57.95, 58.3, 58.61, 58.9, 59.21, 59.56];

        const histLive = {"150": 0, "155": 0, "160": 0, "165": 0, "170": 0, "175": 0, "180": 25, "185": 1, "190": 3, "195": 2, "200": 1, "205": 1, "210": 0, "215": 0, "220": 0, "225": 0};
        const histBtCurrent = {"150": 0, "155": 0, "160": 0, "165": 0, "170": 0, "175": 0, "180": 650, "185": 112, "190": 85, "195": 64, "200": 55, "205": 42, "210": 0, "215": 0, "220": 0, "225": 0};
        const histBtExtended = {"150": 619, "155": 110, "160": 93, "165": 84, "170": 67, "175": 60, "180": 81, "185": 61, "190": 57, "195": 37, "200": 28, "205": 37, "210": 25, "215": 26, "220": 26, "225": 0};

        const hmLive = {"150": null, "151": null, "152": null, "153": null, "154": null, "155": null, "156": null, "157": null, "158": null, "159": null, "160": null, "161": null, "162": null, "163": null, "164": null, "165": null, "166": null, "167": null, "168": null, "169": null, "170": null, "171": null, "172": null, "173": null, "174": null, "175": null, "176": null, "177": null, "178": null, "179": null, "180": 81.2, "181": 33.3, "182": 100.0, "183": 66.7, "184": null, "185": null, "186": 100.0, "187": null, "188": null, "189": null, "190": null, "191": null, "192": null, "193": 100.0, "194": 50.0, "195": null, "196": 100.0, "197": 100.0, "198": null, "199": null, "200": null, "201": null, "202": 100.0, "203": null, "204": null, "205": null, "206": null, "207": null, "208": 0.0, "209": null, "210": null, "211": null, "212": null, "213": null, "214": null, "215": null, "216": null, "217": null, "218": null, "219": null, "220": null, "221": null, "222": null, "223": null, "224": null, "225": null};
        const hmBtCurrent = {"150": null, "151": null, "152": null, "153": null, "154": null, "155": null, "156": null, "157": null, "158": null, "159": null, "160": null, "161": null, "162": null, "163": null, "164": null, "165": null, "166": null, "167": null, "168": null, "169": null, "170": null, "171": null, "172": null, "173": null, "174": null, "175": null, "176": null, "177": null, "178": null, "179": null, "180": 70.3, "181": 79.1, "182": 76.2, "183": 75.8, "184": 64.5, "185": 80.8, "186": 83.3, "187": 76.9, "188": 55.6, "189": 88.9, "190": 72.7, "191": 68.4, "192": 70.0, "193": 53.3, "194": 66.7, "195": 73.3, "196": 76.5, "197": 40.0, "198": 76.9, "199": 55.6, "200": 72.7, "201": 70.0, "202": 63.6, "203": 63.6, "204": 83.3, "205": 72.7, "206": 91.7, "207": 44.4, "208": 80.0, "209": null, "210": null, "211": null, "212": null, "213": null, "214": null, "215": null, "216": null, "217": null, "218": null, "219": null, "220": null, "221": null, "222": null, "223": null, "224": null, "225": null};
        const hmBtExtended = {"150": 71.2, "151": 66.7, "152": 63.3, "153": 70.0, "154": 67.6, "155": 76.5, "156": 64.5, "157": 82.6, "158": 52.4, "159": 66.7, "160": 64.0, "161": 66.7, "162": 80.0, "163": 50.0, "164": 92.3, "165": 70.4, "166": 70.6, "167": 66.7, "168": 68.8, "169": 83.3, "170": 68.8, "171": 60.0, "172": 57.1, "173": 84.6, "174": 57.1, "175": 60.0, "176": 63.6, "177": 100.0, "178": 90.9, "179": 80.0, "180": 79.2, "181": 69.2, "182": 80.0, "183": 76.5, "184": 70.6, "185": 58.3, "186": 81.2, "187": 80.0, "188": 76.9, "189": 60.0, "190": 100.0, "191": 66.7, "192": 66.7, "193": 73.3, "194": 42.9, "195": 75.0, "196": 75.0, "197": 76.9, "198": 66.7, "199": 77.8, "200": 66.7, "201": 71.4, "202": 83.3, "203": 66.7, "204": 83.3, "205": 77.8, "206": 66.7, "207": 88.9, "208": 42.9, "209": 83.3, "210": 50.0, "211": 80.0, "212": 75.0, "213": 85.7, "214": 57.1, "215": 75.0, "216": 33.3, "217": 75.0, "218": 100.0, "219": 80.0, "220": 100.0, "221": 100.0, "222": 85.7, "223": 66.7, "224": 66.7, "225": null};

        const ladderBtCurrent = {"0.64": {"count": 147, "wr": 69.4}, "0.65": {"count": 279, "wr": 68.8}, "0.66": {"count": 81, "wr": 77.8}, "0.67": {"count": 88, "wr": 68.2}, "0.68": {"count": 66, "wr": 74.2}, "0.69": {"count": 134, "wr": 67.2}, "0.7": {"count": 213, "wr": 77.0}};
        const ladderBtExtended = {"0.64": {"count": 249, "wr": 67.1}, "0.65": {"count": 471, "wr": 73.7}, "0.66": {"count": 131, "wr": 69.5}, "0.67": {"count": 93, "wr": 68.8}, "0.68": {"count": 91, "wr": 71.4}, "0.69": {"count": 116, "wr": 73.3}, "0.7": {"count": 260, "wr": 71.5}};

        // Chart 1: Equity Curves
        const maxLen = Math.max(eqLive.length, eqBtCurrent.length, eqBtExtended.length);

        // Downsample for display if needed
        function downsample(arr, maxPoints) {
            if (arr.length <= maxPoints) return arr.map((v, i) => ({x: i, y: v}));
            const step = Math.ceil(arr.length / maxPoints);
            const result = [];
            for (let i = 0; i < arr.length; i += step) {
                result.push({x: i, y: arr[i]});
            }
            if (result[result.length-1].x !== arr.length-1) {
                result.push({x: arr.length-1, y: arr[arr.length-1]});
            }
            return result;
        }

        new Chart(document.getElementById('equityChart'), {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'Live Current',
                        data: downsample(eqLive, 100),
                        borderColor: '#4488ff',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1
                    },
                    {
                        label: 'Backtest Current',
                        data: downsample(eqBtCurrent, 200),
                        borderColor: '#00ff88',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1
                    },
                    {
                        label: 'Backtest Extended',
                        data: downsample(eqBtExtended, 200),
                        borderColor: '#ffcc00',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        type: 'linear',
                        title: { display: true, text: 'Trade #', color: '#888' },
                        grid: { color: '#222' },
                        ticks: { color: '#888' }
                    },
                    y: {
                        title: { display: true, text: 'Cumulative PnL', color: '#888' },
                        grid: { color: '#222' },
                        ticks: { color: '#888' }
                    }
                }
            }
        });

        // Chart 2: Timing Histogram
        const histLabels = Object.keys(histBtExtended).map(s => {
            const sec = parseInt(s);
            const m = Math.floor(sec / 60);
            const ss = sec % 60;
            return m + ':' + String(ss).padStart(2, '0');
        });

        new Chart(document.getElementById('histogramChart'), {
            type: 'bar',
            data: {
                labels: histLabels,
                datasets: [
                    {
                        label: 'Live Current',
                        data: Object.values(histLive),
                        backgroundColor: '#4488ff',
                        barPercentage: 0.9,
                        categoryPercentage: 0.8
                    },
                    {
                        label: 'Backtest Current',
                        data: Object.values(histBtCurrent),
                        backgroundColor: '#00ff88',
                        barPercentage: 0.9,
                        categoryPercentage: 0.8
                    },
                    {
                        label: 'Backtest Extended',
                        data: Object.values(histBtExtended),
                        backgroundColor: '#ffcc00',
                        barPercentage: 0.9,
                        categoryPercentage: 0.8
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        title: { display: true, text: 'Entry Time (m:ss)', color: '#888' },
                        grid: { display: false },
                        ticks: { color: '#888', maxRotation: 45 }
                    },
                    y: {
                        title: { display: true, text: 'Trade Count', color: '#888' },
                        grid: { color: '#222' },
                        ticks: { color: '#888' }
                    }
                }
            }
        });

        // Heatmap
        function getHeatmapColor(wr) {
            if (wr === null) return '#2a2a3a';
            if (wr < 50) return `rgb(${Math.round(255)}, ${Math.round(68 + wr)}, ${Math.round(68)})`;
            if (wr < 70) return `rgb(${Math.round(255)}, ${Math.round(150 + (wr-50)*5)}, ${Math.round(0)})`;
            return `rgb(${Math.round(0)}, ${Math.round(200 + (wr-70)*2)}, ${Math.round(100 + (wr-70)*2)})`;
        }

        const heatmapContainer = document.getElementById('heatmapContainer');
        const datasets = [
            { name: 'BT Extended', data: hmBtExtended },
            { name: 'BT Current', data: hmBtCurrent },
            { name: 'Live Current', data: hmLive }
        ];

        // Header row with second labels
        let headerHtml = '<div class="heatmap-row"><div class="heatmap-label"></div><div class="heatmap-cells">';
        for (let sec = 150; sec <= 225; sec++) {
            if (sec % 5 === 0) {
                const m = Math.floor(sec / 60);
                const s = sec % 60;
                headerHtml += `<div style="width:12px;text-align:center;color:#666;font-size:8px">${m}:${String(s).padStart(2,'0')}</div>`;
            } else {
                headerHtml += '<div style="width:12px"></div>';
            }
        }
        headerHtml += '</div></div>';
        heatmapContainer.innerHTML = headerHtml;

        datasets.forEach(ds => {
            let rowHtml = `<div class="heatmap-row"><div class="heatmap-label">${ds.name}</div><div class="heatmap-cells">`;
            for (let sec = 150; sec <= 225; sec++) {
                const wr = ds.data[sec];
                const color = getHeatmapColor(wr);
                const text = wr !== null ? Math.round(wr) : '';
                rowHtml += `<div class="heatmap-cell" style="background:${color}" title="Sec ${sec}: ${wr !== null ? wr + '%' : 'N/A'}">${text}</div>`;
            }
            rowHtml += '</div></div>';
            heatmapContainer.innerHTML += rowHtml;
        });

        // Edge Ladder
        const ladderBody = document.getElementById('ladderBody');
        const allEdges = new Set([...Object.keys(ladderBtCurrent), ...Object.keys(ladderBtExtended)]);
        const sortedEdges = Array.from(allEdges).sort((a, b) => parseFloat(a) - parseFloat(b));

        sortedEdges.forEach(edge => {
            const curr = ladderBtCurrent[edge] || { count: 0, wr: '-' };
            const ext = ladderBtExtended[edge] || { count: 0, wr: '-' };

            let delta = '-';
            let deltaColor = '#888';
            if (typeof curr.wr === 'number' && typeof ext.wr === 'number') {
                const d = (ext.wr - curr.wr).toFixed(1);
                delta = (d >= 0 ? '+' : '') + d + '%';
                deltaColor = d >= 0 ? '#00ff88' : '#ff4444';
            }

            const currBar = typeof curr.wr === 'number'
                ? `<div class="bar" style="width:${curr.wr}px;background:#00ff88"></div> ${curr.wr}%`
                : '-';
            const extBar = typeof ext.wr === 'number'
                ? `<div class="bar" style="width:${ext.wr}px;background:#ffcc00"></div> ${ext.wr}%`
                : '-';

            ladderBody.innerHTML += `
                <tr>
                    <td>${parseFloat(edge).toFixed(2)}</td>
                    <td>${curr.count || '-'}</td>
                    <td>${currBar}</td>
                    <td>${ext.count || '-'}</td>
                    <td>${extBar}</td>
                    <td style="color:${deltaColor}">${delta}</td>
                </tr>
            `;
        });
    </script>
</body>
</html>
